version: 2.1
jobs:
  build:
    docker:
      - image: circleci/python:3.7.2
    working_directory: ~/docker_django_sns/myproject
    steps:
      - checkout
      - run:
          name: フォルダ移動
          command: cd myproject
      - run:
          name: データベースのmigrate
          command: |
          docker-compose run web python3 manage.py makemigrations
          docker-compose run web python3 manage.py migrate
      - run:
          name: Dockerコンテナのビルド
          command: docker-compose build
      - run:
          name: django,test_views.py実行
          command:　docker-compose run web python3 manage.py test
      - run:
          name: Dockerコンテナの起動
          command: docker-compose up
      - run:
          name: Dockerコンテナの停止
          command: docker-compose down